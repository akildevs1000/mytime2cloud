(window.webpackJsonp=window.webpackJsonp||[]).push([[7,47],{828:function(t,e,n){"use strict";n.r(e);var r=n(83),o=(n(51),{data:function(){return{currentDate:"",currentTime:""}},methods:{updateClock:function(){var t=new Date;this.currentDate=t.toLocaleDateString("en-US",{weekday:"long",month:"short",day:"numeric"}),this.currentTime=t.toLocaleTimeString()}},mounted:function(){this.updateClock(),setInterval(this.updateClock,1e3)}}),c=n(72),component=Object(c.a)(o,(function(){var t=this,e=t._self._c;return e("div",[e(r.a,{class:t.$isDark()?"accent":"light-background"},[t._v("\n    "+t._s(t.currentDate))]),t._v(" "),e(r.a,{class:t.$isDark()?"accent":"light-background"},[t._v("\n    "+t._s(t.currentTime)+"\n  ")])],1)}),[],!1,null,"314b86da",null);e.default=component.exports},863:function(t,e,n){"use strict";n.r(e);var r=n(807),o=n(271),c=n(747),l=n(741),d=n(755),m=n(723),h=n(916),v=n(920),_=n(162),f=n(210),y=n(754),x=n(83),D=n(719),k=n(78),C=n(20),L=n(19),w=(n(51),n(27),n(441),n(4),n(43),n(79),n(26),n(74),{data:function(){return{sinceDate:null,UserID:null,profile_pictrue:"no-profile-image.jpg",logsCount:null,company_id:0,lastLog:null,employee_stats:[],todayAttendance:null,remainingTime:"00:00",headers:[{text:"LogTime",value:"LogTime"},{text:"Device",value:"DeviceID"}],attendanceLogs:[],log_type:"",puching_image:"",response_image:"/sucess.png",uniqueDeviceId:null,device_id:null,isButtonDisabled:!1,message:"",response:"",dialog:!1,buttonLocked:!1,locationError:null,intervalId:0,locationData:null,initialPunch:!0,shift_type_id:0,initialCount:59}},mounted:function(){window.innerWidth>=600?this.$store.commit("isDesktop",!0):this.$store.commit("isDesktop",!1),this.getSinceDate();var t=localStorage.getItem("timeCounter");null===t||isNaN(t)||(this.initialCount=t<0?59:parseInt(t)),this.lockButton(),this.$store.state.isDesktop&&this.$router.push("/dashboard")},computed:{latitude:function(){return this.$store.state.latitude},longitude:function(){return this.$store.state.longitude},currentDate:function(){return this.$store.state.currentDate}},created:function(){var t=this;return Object(L.a)(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.$auth.user.employee){e.next=4;break}return t.$router.push("/login"),e.abrupt("return");case 4:return t.profile_pictrue=n.profile_picture,t.UserID=n.system_user_id,n.schedule.shift&&(t.shift_type_id=n.schedule.shift_type_id),t.company_id=t.$auth.user.company_id,t.device_id="Mobile-".concat(t.UserID),e.next=11,t.getEmployeeStats();case 11:return e.next=13,t.getLastLog();case 13:return e.next=15,t.getTodayAttendance();case 15:return e.next=17,t.getRealTimeLocation();case 17:case"end":return e.stop()}}),e)})))()},methods:{lockButton:function(){var t=this;this.timeCounterInterval=setInterval((function(){t.initialCount>0?(t.buttonLocked=!0,t.$localStorage.set("timeCounter",--t.initialCount)):(clearInterval(t.timeCounterInterval),t.buttonLocked=!1,t.initialCount=59)}),1e3)},getLastLog:function(){var t=this;return Object(L.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.$axios.get("attendance_logs",{params:{company_id:t.company_id,UserID:t.UserID,from_date:t.getFormattedDate(),to_date:t.getFormattedDate()}}).then((function(e){var n,r,data=e.data;if(null==data||null===(n=data.data)||void 0===n||!n.length)return t.log_type="in",void(t.puching_image="/C-IN.png");(null==data||null===(r=data.data)||void 0===r?void 0:r.length)%2!=0?(t.log_type="out",t.puching_image="/C-OUT.png",t.initialPunch=!1,t.$auth.user.tracking_status&&t.invokeRealtimeLocation()):(t.log_type="in",t.puching_image="/C-IN.png",clearInterval(t.intervalId)),t.lastLog=data.data[0]}));case 1:case"end":return e.stop()}}),e)})))()},invokeRealtimeLocation:function(){var t=this;this.insertRealTimeLocation(),this.intervalId=setInterval((function(){t.insertRealTimeLocation()}),6e4)},submit:function(){var t=this;return this.lockPunchTime()?(this.dialog=!0,this.message="You can only punch after your last puch time (".concat(this.lastLog.time,")"),this.response_image="/fail.png",void setTimeout((function(){return t.dialog=!1}),3e3)):this.buttonLocked?(this.dialog=!0,this.message="Next Clocking allowed after 1 minute only",this.response_image="/fail.png",void setTimeout((function(){return t.dialog=!1}),3e3)):(this.lockButton(),void this.processLog())},lockPunchTime:function(){return!!this.lastLog&&new Date<new Date("".concat(this.lastLog.edit_date,"T").concat(this.lastLog.time,":00"))},processLog:function(){var t=this,e={UserID:this.UserID,LogTime:"".concat(this.getFormattedDate()," ").concat(this.getFormattedTime()),log_type:this.log_type,DeviceID:this.device_id,company_id:this.$auth.user.company_id,gps_location:this.locationData.display_name||"location not found"};this.$axios.post("/generate_log",e).then(function(){var e=Object(L.a)(regeneratorRuntime.mark((function e(n){var data;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(data=n.data,t.dialog=!0,data.status){e.next=7;break}return t.message=data.message,t.response_image="/fail.png",setTimeout((function(){return t.dialog=!1}),3e3),e.abrupt("return");case 7:return t.message="Your clocking has been recorded successfully",t.response_image="/success.png",e.next=11,t.renderAttendance();case 11:t.registerDeviceIfNotExist();case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){var n=e.message;t.message=n,t.response_image="/fail.png"})),setTimeout((function(){return t.dialog=!1}),3e3)},renderAttendance:function(){var t=this;return Object(L.a)(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.$axios.get("/render_logs",{params:{company_ids:[t.company_id],employee_ids:[t.UserID],dates:[t.getFormattedDate(),t.getFormattedDate()],shift_type_id:t.shift_type_id}});case 3:return n=e.sent,n.data,e.next=7,t.getEmployeeStats();case 7:return e.next=9,t.getLastLog();case 9:return e.next=11,t.getTodayAttendance();case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(0),console.error(e.t0);case 16:case"end":return e.stop()}}),e,null,[[0,13]])})))()},insertRealTimeLocation:function(){var t=this;"geolocation"in navigator?navigator.geolocation.getCurrentPosition((function(e){var n=e.coords,r=n.latitude,o=n.longitude,c={company_id:t.company_id,device_id:t.device_id,UserID:t.UserID,latitude:r,longitude:o,short_name:"---",full_name:"---"};t.$axios.post("/realtime_location",c).then(function(){var e=Object(L.a)(regeneratorRuntime.mark((function e(n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.data,e.next=3,t.setRealTimeLocation(r,o);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(t){var e=t.message;return console.log(e)}))}),(function(e){var n=e.message;t.locationError=n})):this.locationError="Location not available"},registerDeviceIfNotExist:function(){var t,e={device_id:this.device_id,name:this.device_id,short_name:this.device_id,model_number:this.device_id,location:null!==(t=this.locationData.display_name)&&void 0!==t?t:"---",company_id:this.$auth.user.company_id,branch_id:this.$auth.user.employee.branch_id,status_id:1,function:"ignore",utc_time_zone:"ignore",device_type:"Mobile",ip:"0.0.0.0",port:"0000"};this.$axios.post("/device",e).then((function(t){var data=t.data;return console.log(data.message)})).catch((function(t){var e=t.message;return console.log(e)}))},getSinceDate:function(){var t=new Date,e="1".padStart(2,"0"),n=(t.getMonth()+1).toString().padStart(2,"0"),r=t.getFullYear();this.sinceDate="".concat(e,"/").concat(n,"/").concat(r)},getFormattedTime:function(){var t=new Date;return"".concat(String(t.getHours()).padStart(2,"0"),":").concat(String(t.getMinutes()).padStart(2,"0"))},setRealTimeLocation:function(t,e){var n=this;return Object(L.a)(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:n.$axios.get("https://nominatim.openstreetmap.org/reverse?lat=".concat(t,"&lon=").concat(e,"&format=json")).then((function(r){var data=r.data;n.initialPunch=!1,n.locationData=data,n.$store.commit("latitude",t),n.$store.commit("longitude",e),n.$store.commit("currentDate",n.getFormattedDate())})).catch((function(t){var e=t.message;return console.log(n.locationError=e)}));case 1:case"end":return r.stop()}}),r)})))()},getRealTimeLocation:function(){var t=this;return Object(L.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:"geolocation"in navigator?navigator.geolocation.getCurrentPosition((function(e){var n=e.coords,r=n.latitude,o=n.longitude;t.$axios.get("https://nominatim.openstreetmap.org/reverse?lat=".concat(r,"&lon=").concat(o,"&format=json")).then((function(e){var data=e.data;t.locationData=data,t.$store.commit("currentDate",t.getFormattedDate())})).catch((function(e){var n=e.message;return console.log(t.locationError=n)}))}),(function(e){var n=e.message;t.locationError=n})):t.locationError="Location not available";case 1:case"end":return e.stop()}}),e)})))()},getTodayAttendance:function(){var t=this;return Object(L.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.$axios.get("report",{params:{company_id:t.company_id,employee_id:t.UserID,from_date:t.getFormattedDate(),to_date:t.getFormattedDate()}}).then((function(e){var data=e.data;if(!data.data.length)return t.getRemainingTime("00:00","00:00"),void(t.todayAttendance={total_hrs:"00:00",ot:"00:00"});var n=data.data[0],r=n.total_hrs,o=n.ot,c=n.shift;if(!c)return t.getRemainingTime("00:00","00:00"),void(t.todayAttendance={total_hrs:"00:00",ot:"00:00"});t.todayAttendance={total_hrs:t.timeHandler(r),ot:t.timeHandler(o)},t.getRemainingTime(t.timeHandler(r),t.timeHandler(c.working_hours))}));case 1:case"end":return e.stop()}}),e)})))()},timeHandler:function(t){return"---"===t?"00:00":t},getEmployeeStats:function(){var t=this;return Object(L.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.$axios.get("employee-statistics",{params:{company_id:t.company_id,employee_id:t.UserID}}).then((function(e){var data=e.data;t.employee_stats=data}));case 1:case"end":return e.stop()}}),e)})))()},goToPage:function(t){this.$router.push(t)},getFormattedDate:function(){var t=new Date;return"".concat(t.getFullYear(),"-").concat(String(t.getMonth()+1).padStart(2,"0"),"-").concat(String(t.getDate()).padStart(2,"0"))},getRemainingTime:function(t,e){var n=t.split(":").map(Number),r=Object(C.a)(n,2),o=r[0],c=r[1],l=e.split(":").map(Number),d=Object(C.a)(l,2),m=60*o+c-(60*d[0]+d[1]);if(m<0){var h=Math.abs(Math.ceil(m/60)),v=Math.abs(m%60);this.remainingTime="".concat(String(h).padStart(2,"0"),":").concat(String(v).padStart(2,"0"))}}}}),S=w,$=n(72),component=Object($.a)(S,(function(){var t=this,e=t._self._c;return e("div",[t.shift_type_id?t._e():e(r.a,{staticClass:"red lighten-2",attrs:{dark:"",dense:"",flat:""}},[e("div",{},[t._v("Your are not schedule yet")])]),t._v(" "),e("div",{staticClass:"text-center"},[e(h.a,{staticClass:"remove-transparent-bg",staticStyle:{"box-shadow":"none !important"},attrs:{width:"500"},model:{value:t.dialog,callback:function(e){t.dialog=e},expression:"dialog"}},[e(c.a,{staticStyle:{background:"none"}},[e(k.a,{staticStyle:{background:"none"},attrs:{flat:"",dense:""}},[e(D.a)],1),t._v(" "),e(l.b,[e("p",{staticClass:"text-center"},[e(f.a,{staticStyle:{display:"inline-block"},attrs:{src:t.response_image,alt:"Avatar",height:"125px",width:"125px"}})],1)])],1)],1)],1),t._v(" "),e(c.a,{class:t.$isDark()?"accent":"light-background"},[e(m.a,[e(y.a,{attrs:{"no-gutters":""}},[e(d.a,{staticClass:"text-center",attrs:{cols:"12"}},[e(o.a,{attrs:{size:"150"}},[e("img",{staticStyle:{width:"100%"},attrs:{src:t.profile_pictrue,alt:"Avatar"}})])],1),t._v(" "),e(d.a,{staticClass:"text-center",attrs:{cols:"12"}},[e("div",{staticClass:"text-h6"},[e("b",[t._v(t._s(t.$auth.user.employee.first_name)+"\n              "+t._s(t.$auth.user.employee.last_name))])]),t._v(" "),e("WallClock")],1)],1),t._v(" "),e(y.a,[e(d.a,{staticClass:"text-center",staticStyle:{"border-top":"1px solid #b8a9eb"},attrs:{cols:"12"}},[e("div",[e("span",{style:{color:t.$isDark()?"":"#8f31e9"}},[t._v("Self Discipline Indicator")]),t._v(" "),e("span",[t._v(" (For own reference only)")])])])],1),t._v(" "),e(y.a,[e(d.a,{staticClass:"text-center",staticStyle:{"border-top":"1px solid #b8a9eb","border-bottom":"1px solid #b8a9eb"},attrs:{cols:"4"}},[e(x.a,{staticClass:"text-h6",class:t.$isDark()?"accent":"light-background"},[t._v("\n            "+t._s(t.todayAttendance&&t.todayAttendance.total_hrs)+"\n          ")]),t._v(" "),e("div",[t._v("Work Time")])],1),t._v(" "),e(d.a,{staticClass:"text-center",staticStyle:{border:"1px solid #b8a9eb"},attrs:{cols:"4"}},[e(x.a,{staticClass:"text-h6",class:t.$isDark()?"accent":"light-background"},[t._v("\n            "+t._s(t.remainingTime)+"\n          ")]),t._v(" "),e("div",[t._v("Remaing Hours")])],1),t._v(" "),e(d.a,{staticClass:"text-center",staticStyle:{"border-top":"1px solid #b8a9eb","border-bottom":"1px solid #b8a9eb"},attrs:{cols:"4"}},[e(x.a,{staticClass:"text-h6",class:t.$isDark()?"accent":"light-background"},[t._v("\n            "+t._s(t.todayAttendance&&t.todayAttendance.ot)+"\n          ")]),t._v(" "),e("div",[t._v("OverTime")])],1)],1),t._v(" "),e(y.a,{staticStyle:{"border-bottom":"1px solid #b8a9eb"}},[e(d.a,{staticClass:"text-center",attrs:{cols:"12"}},[e("div",[e("span",[t._v("My Attendance")]),t._v(" "),e("span",{style:{color:t.$isDark()?"":"#8f31e9"}},[t._v("\n              - Since "+t._s(t.sinceDate)+"\n            ")])])])],1),t._v(" "),e(y.a,[e(d.a,{attrs:{cols:"12"}},[e(m.a,[e(y.a,[e(d.a,{staticClass:"text-center",attrs:{cols:"6"}},[e("div",{staticClass:"text-center mt-5"},[e(o.a,{attrs:{size:"125"}},[e("img",{staticStyle:{width:"100%",height:"auto"},attrs:{src:t.puching_image,alt:"loading..."},on:{click:t.submit}})])],1)]),t._v(" "),e(d.a,{attrs:{cols:"6"}},t._l(t.employee_stats,(function(n,r){return e(y.a,{key:r,staticClass:"greys",staticStyle:{padding:"1px !important","border-bottom":"0px solid #b8a9eb"},attrs:{"no-gutters":""}},[e(d.a,{attrs:{cols:"10"}},[t._v(t._s(n.title)+" ")]),t._v(" "),e(d.a,{staticClass:"text-right"},[e("span",[t._v("\n                      "+t._s(n.value)+"\n                    ")])])],1)})),1),t._v(" "),e(d.a,{attrs:{cols:"12"}},[t.locationError?e("div",{staticClass:"error--text"},[t._v("\n                  "+t._s(t.locationError)+"\n                ")]):t._e()])],1)],1)],1)],1),t._v(" "),e(v.a,{staticClass:"ma-0 pa-0",staticStyle:{"border-top":"1px solid #dddddd"},attrs:{app:""}},[e(y.a,{class:t.$isDark()?"accent":"light-background",attrs:{"no-gutters":""}},[e(d.a,{staticClass:"pl-2",attrs:{cols:"12"}},[e("div",{staticClass:"text-h6"},[t._v("Location")]),t._v(" "),e("div",{},[e("b",[t._v(t._s(t.lastLog&&t.lastLog.device&&t.lastLog.gps_location))]),t._v(" "),e(_.a,{staticStyle:{"margin-top":"-2%"},attrs:{color:"green"}},[t._v("mdi-map-marker-radius")])],1),t._v(" "),e("span",{staticClass:"white--text"},[t._v("\n              "+t._s(t.lastLog&&t.lastLog.date)+" "+t._s(t.lastLog&&t.lastLog.time)+"\n            ")])])],1)],1)],1)],1)],1)}),[],!1,null,null,null);e.default=component.exports;installComponents(component,{WallClock:n(828).default})}}]);